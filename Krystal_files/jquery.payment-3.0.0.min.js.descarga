(function(){var $,b,c,d,a,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=[].slice,z=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return -1};($=window.jQuery||window.Zepto||window.$).payment={},$.payment.fn={},$.fn.payment=function(){var a,b;return b=arguments[0],a=2<=arguments.length?y.call(arguments,1):[],$.payment.fn[b].apply(this,a)},a=/(\d{1,4})/g,$.payment.cards=d=[{type:"maestro",patterns:[5018,502,503,506,56,58,639,6220,67],format:a,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:a,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:a,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:a,length:[16],cvcLength:[3],luhn:!0}],b=function(a){if(d.length){x||(x=d.reduce(function(a,b){var c=b.patterns.map(function(a){return{pattern:a,card:b}});return a.concat(c)},[]).sort(function(a,b){return a.pattern>b.pattern?-1:1}));var b,c=(a+"").replace(/\D/g,"");return x.some(function(a){var d=a.pattern+"";if(c.substr(0,d.length)===d)return b=a.card,!0}),b}},c=function(e){var b,a,c;for(a=0,c=d.length;a<c;a++)if((b=d[a]).type===e)return b},l=function(g){var a,e,c,d,b,f;for(b=0,c=!0,d=0,f=(e=(g+"").split("").reverse()).length;b<f;b++)a=parseInt(a=e[b],10),(c=!c)&&(a*=2),a>9&&(a-=9),d+=a;return d%10==0},k=function(a){var b;return null!=a.prop("selectionStart")&&a.prop("selectionStart")!==a.prop("selectionEnd")||("undefined"!=typeof document&&null!==document&&null!=(b=document.selection)?b.createRange:void 0)!=null&&!!document.selection.createRange().text},v=function(c,b){var f,a,d,e,g;try{a=b.prop("selectionStart")}catch(h){a=null}if(e=b.val(),b.val(c),null!==a&&b.is(":focus"))return a===e.length&&(a=c.length),e!==c&&(g=e.slice(a-1,+a+1||9e9),f=c.slice(a-1,+a+1||9e9),d=c[a],/\d/.test(d)&&g===""+d+" "&&f===" "+d&&(a+=1)),b.prop("selectionStart",a),b.prop("selectionEnd",a)},q=function(c){var d,a,f,g,h,e,b,i;for(null==c&&(c=""),f="\uFF10\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19",g="0123456789",e="",d=c.split(""),b=0,i=d.length;b<i;b++)a=d[b],(h=f.indexOf(a))> -1&&(a=g[h]),e+=a;return e},p=function(a){var b;return b=$(a.currentTarget),setTimeout(function(){return v(q(b.val()).replace(/\D/g,""),b)})},n=function(a){var b;return b=$(a.currentTarget),setTimeout(function(){var a;return a=q(a=b.val()),v(a=$.payment.formatCardNumber(a),b)})},g=function(e){var f,a,c,h,i,g,d;return(c=String.fromCharCode(e.which),/^\d+$/.test(c))?(a=b((d=(f=$(e.currentTarget)).val())+c),h=(d.replace(/\D/g,"")+c).length,g=16,a&&(g=a.length[a.length.length-1]),h>=g||null!=f.prop("selectionStart")&&f.prop("selectionStart")!==d.length)?void 0:(i=a&&"amex"===a.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/).test(d)?(e.preventDefault(),setTimeout(function(){return f.val(d+" "+c)})):i.test(d+c)?(e.preventDefault(),setTimeout(function(){return f.val(d+c+" ")})):void 0:void 0},e=function(a){var c,b;return(b=(c=$(a.currentTarget)).val(),8!==a.which||null!=c.prop("selectionStart")&&c.prop("selectionStart")!==b.length)?void 0:/\d\s$/.test(b)?(a.preventDefault(),setTimeout(function(){return c.val(b.replace(/\d\s$/,""))})):/\s\d?$/.test(b)?(a.preventDefault(),setTimeout(function(){return c.val(b.replace(/\d$/,""))})):void 0},o=function(a){var b;return b=$(a.currentTarget),setTimeout(function(){var a;return a=q(a=b.val()),v(a=$.payment.formatExpiry(a),b)})},h=function(b){var d,c,a;return(c=String.fromCharCode(b.which),/^\d+$/.test(c))?(a=(d=$(b.currentTarget)).val()+c,/^\d$/.test(a)&&"0"!==a&&"1"!==a)?(b.preventDefault(),setTimeout(function(){return d.val("0"+a+" / ")})):/^\d\d$/.test(a)?(b.preventDefault(),setTimeout(function(){var b,c;return(b=parseInt(a[0],10),c=parseInt(a[1],10),c>2&&0!==b)?d.val("0"+b+" / "+c):d.val(""+a+" / ")})):void 0:void 0},i=function(b){var c,d,a;if(d=String.fromCharCode(b.which),/^\d+$/.test(d)&&(a=(c=$(b.currentTarget)).val(),/^\d\d$/.test(a)))return c.val(""+a+" / ")},j=function(b){var c,a,d;if(("/"===(d=String.fromCharCode(b.which))||" "===d)&&(a=(c=$(b.currentTarget)).val(),/^\d$/.test(a)&&"0"!==a))return c.val("0"+a+" / ")},f=function(a){var b,c;if(c=(b=$(a.currentTarget)).val(),8===a.which&&(null==b.prop("selectionStart")||b.prop("selectionStart")===c.length)&&/\d\s\/\s$/.test(c))return a.preventDefault(),setTimeout(function(){return b.val(c.replace(/\d\s\/\s$/,""))})},m=function(a){var b;return b=$(a.currentTarget),setTimeout(function(){return v(q(b.val()).replace(/\D/g,"").slice(0,4),b)})},u=function(a){var b;return!!a.metaKey||!!a.ctrlKey||32!==a.which&&(0===a.which||a.which<33||(b=String.fromCharCode(a.which),!!/[\d\s]/.test(b)))},s=function(f){var a,c,d,e;return(a=$(f.currentTarget),d=String.fromCharCode(f.which),!/^\d+$/.test(d)||k(a))?void 0:(c=b(e=(a.val()+d).replace(/\D/g,"")))?e.length<=c.length[c.length.length-1]:e.length<=16},t=function(c){var a,b;if(a=$(c.currentTarget),b=String.fromCharCode(c.which),!(!/^\d+$/.test(b)||k(a))&&(a.val()+b).replace(/\D/g,"").length>6)return!1},r=function(c){var a,b;if(a=$(c.currentTarget),b=String.fromCharCode(c.which),!(!/^\d+$/.test(b)||k(a)))return(a.val()+b).length<=4},w=function(f){var a,c,g,b,e;if(e=(a=$(f.currentTarget)).val(),b=$.payment.cardType(e)||"unknown",!a.hasClass(b))return c=function(){var a,c,b;for(a=0,b=[],c=d.length;a<c;a++)g=d[a],b.push(g.type);return b}(),a.removeClass("unknown"),a.removeClass(c.join(" ")),a.addClass(b),a.toggleClass("identified","unknown"!==b),a.trigger("payment.cardType",b)},$.payment.fn.formatCardCVC=function(){return this.on("keypress",u),this.on("keypress",r),this.on("paste",m),this.on("change",m),this.on("input",m),this},$.payment.fn.formatCardExpiry=function(){return this.on("keypress",u),this.on("keypress",t),this.on("keypress",h),this.on("keypress",j),this.on("keypress",i),this.on("keydown",f),this.on("change",o),this.on("input",o),this},$.payment.fn.formatCardNumber=function(){return this.on("keypress",u),this.on("keypress",s),this.on("keypress",g),this.on("keydown",e),this.on("keyup",w),this.on("paste",n),this.on("change",n),this.on("input",n),this.on("input",w),this},$.payment.fn.restrictNumeric=function(){return this.on("keypress",u),this.on("paste",p),this.on("change",p),this.on("input",p),this},$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val())},$.payment.cardExpiryVal=function(d){var b,a,c;return b=(c=d.split(/[\s\/]+/,2))[0],(null!=(a=c[1])?a.length:void 0)===2&&/^\d+$/.test(a)&&(a=(new Date).getFullYear().toString().slice(0,2)+a),b=parseInt(b,10),a=parseInt(a,10),{month:b,year:a}},$.payment.validateCardNumber=function(a){var c,d;return a=(a+"").replace(/\s+|-/g,""),!!(/^\d+$/.test(a)&&(c=b(a)))&&(d=a.length,z.call(c.length,d)>=0&&(!1===c.luhn||l(a)))},$.payment.validateCardExpiry=function(b,a){var d,c,e;return"object"==typeof b&&"month"in b&&(b=(e=b).month,a=e.year),!!b&&!!a&&(b=$.trim(b),a=$.trim(a),!!(/^\d+$/.test(b)&&/^\d+$/.test(a))&&1<=b&&b<=12&&(2===a.length&&(a=a<70?"20"+a:"19"+a),4===a.length&&(c=new Date(a,b),d=new Date,c.setMonth(c.getMonth()-1),c.setMonth(c.getMonth()+1,1),c>d)))},$.payment.validateCardCVC=function(a,e){var b,d;return a=$.trim(a),!!/^\d+$/.test(a)&&(null!=(b=c(e))?(d=a.length,z.call(b.cvcLength,d)>=0):a.length>=3&&a.length<=4)},$.payment.cardType=function(a){var c;return a&&(null!=(c=b(a))?c.type:void 0)||null},$.payment.formatCardNumber=function(a){var c,d,e,f;return(c=b(a=a.replace(/\D/g,"")))?(e=c.length[c.length.length-1],a=a.slice(0,e),c.format.global)?null!=(f=a.match(c.format))?f.join(" "):void 0:null!=(d=c.format.exec(a))?(d.shift(),(d=$.grep(d,function(a){return a})).join(" ")):void 0:a},$.payment.formatExpiry=function(e){var a,c,b,d;return(c=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(a=c[1]||"",b=c[2]||"",d=c[3]||"",d.length>0?b=" / ":" /"===b?(a=a.substring(0,1),b=""):2===a.length||b.length>0?b=" / ":1===a.length&&"0"!==a&&"1"!==a&&(a="0"+a,b=" / "),a+b+d):""}}).call(this)